%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% LaTeX Folienvorlage f√ºr die TH Deggendorf
% Andreas Fischer, 2022
%
% Die Vorlage ist unter folgendem Link zu finden:
% https://mygit.th-deg.de/afischer/thd-latex-vorlagen
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemethdeg2022}
 [August 2022, Folienvorlage TH Deggendorf]

\mode<presentation>

\RequirePackage{tikz}
\RequirePackage{microtype}

\usetikzlibrary{chains,shapes,backgrounds}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Set up colors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Primary
\definecolor{THD-BLAU}{HTML}{1a4273}
\definecolor{THD-GRAU}{HTML}{6f6f6e}

% Secondary
\definecolor{thd-biw}{HTML}{13a538} % green
\definecolor{thd-bwl}{HTML}{B2110E} % red
\definecolor{thd-et-mt}{HTML}{e8b300} % yellow
\definecolor{thd-mb}{HTML}{0085c8} % blue
\definecolor{thd-nuw}{HTML}{59358c} % purple
\definecolor{thd-agw}{HTML}{F18700} % orange
\definecolor{thd-ai}{HTML}{E63c54} % coral
\definecolor{thd-ecri}{HTML}{16A1af} % cyan

% Tertiary
\definecolor{MITTELGRAU}{HTML}{a8a8a8}
\definecolor{HELLGRAU}{HTML}{dadada}

\DeclareOption{thd}{\colorlet{FacultyColor}{THD-BLAU}}
\DeclareOption{biw}{\colorlet{FacultyColor}{thd-biw}}
\DeclareOption{bwl}{\colorlet{FacultyColor}{thd-bwl}}
\DeclareOption{et-mt}{\colorlet{FacultyColor}{thd-et-mt}}
\DeclareOption{mb}{\colorlet{FacultyColor}{thd-mb}}
\DeclareOption{nuw}{\colorlet{FacultyColor}{thd-nuw}}
\DeclareOption{agw}{\colorlet{FacultyColor}{thd-agw}}
\DeclareOption{ai}{\colorlet{FacultyColor}{thd-ai}}
\DeclareOption{ecri}{\colorlet{FacultyColor}{thd-ecri}}

\ExecuteOptions{thd}
\ProcessOptions%

\setbeamercolor{footline}{fg=THD-BLAU}
\setbeamercolor{title}{fg=THD-BLAU}
\setbeamercolor{subtitle}{fg=white}
\setbeamercolor{frametitle}{fg=white}
\setbeamercolor{framesubtitle}{fg=THD-BLAU}
\setbeamercolor{block title}{fg=white,bg=FacultyColor}
\setbeamercolor{block body}{bg=HELLGRAU}
\setbeamercolor{itemize item}{fg=THD-BLAU}
\setbeamercolor{itemize subitem}{fg=THD-BLAU}

\setbeamercolor{normal text}{fg=black,bg=white} 
\setbeamercolor{alerted text}{fg=FacultyColor} 
\setbeamercolor{example text}{fg=black} 
\setbeamercolor{structure}{fg=THD-BLAU} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Set up fonts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamerfont{title}{shape=\sffamily\scshape,size=\Huge}
\setbeamerfont{subtitle}{shape=\normalfont\sffamily\bfseries,size=\Large}
\setbeamerfont{frametitle}{shape=\sffamily\scshape}
\setbeamerfont{framesubtitle}{shape=\sffamily\scshape,size=\normalsize}
\setbeamerfont{section in head/foot}{shape=\scshape,size=\tiny}
\setbeamerfont{footline}{size=\footnotesize}


\setbeamertemplate{navigation symbols}{}

\setbeamertemplate{background}
{%
  \ifnum\c@framenumber=1
  \includegraphics[trim=0 1.5cm 0 2.5cm,clip,width=\paperwidth]{BG_Fak_AI.jpeg}
  \else
  \fi
}

\setbeamertemplate{title page}
{%
\begin{flushright}
    \includegraphics[width=4cm]{THD_Logo.pdf}\par
\end{flushright}
\vspace{.3cm}
\begin{beamercolorbox}{title}
	\usebeamerfont{title}
	\begin{tikzpicture}
	\node[anchor=base west] (title) at (0,0) {\inserttitle};
	\begin{scope}[on background layer]
		\filldraw[color=white] ([shift={(-.1,.1)}] title.south west) -- ([shift={(.3,0)}] title.south east) -- (title.north east) -- ([shift={(0,-.1)}] title.north west) -- cycle;
	\end{scope}
	\end{tikzpicture}
\end{beamercolorbox}
\begin{beamercolorbox}{subtitle}
	\usebeamerfont{subtitle}
	\begin{tikzpicture}
	\node at (0,0) {};
	\node[anchor=base west,align=left] (subtitle) at (0,0) {\insertsubtitle};
	\begin{scope}[on background layer]
	\filldraw[fill=FacultyColor,fill opacity=0.4,draw=none] (subtitle.north west) rectangle (subtitle.south east);
	\end{scope}
	\end{tikzpicture}
\end{beamercolorbox}
}

\setbeamertemplate{footline} % show slide number on all slides but the first
{%
    \hspace{.05\textwidth}
    \begin{minipage}{.1\textwidth}
    \tikz[
	    every node/.style={circle,on chain},
	    start chain=going right,
	    node distance=1mm,
	    inner sep=.07cm,
	    ]
	    {%
	    \node[fill=thd-biw] {};
	    \node[fill=thd-bwl] {};
	    \node[fill=thd-et-mt] {};
	    \node[fill=thd-mb] {};
	    \node[fill=thd-nuw] {};
	    \node[fill=thd-agw] {};
	    \node[fill=thd-ai] {};
	    \node[fill=thd-ecri] {};
    }
  \end{minipage}
  \hspace{.05\textwidth}
  \begin{minipage}{.7\textwidth}
    \begin{beamercolorbox}[center]{footline}
	    \textls{\insertshortauthor, \insertshorttitle, \insertdate}
    \end{beamercolorbox}
  \end{minipage}
  \begin{minipage}{.45cm}
  \ifnum\c@framenumber=1
  \else
    \begin{beamercolorbox}[right]{footline}
	    \insertframenumber/\inserttotalframenumber
    \end{beamercolorbox}
  \fi%
  \end{minipage}

  \vspace{.3cm}
  \noindent
  \textcolor{FacultyColor}{\rule{\textwidth}{.1cm}}
}

\setbeamertemplate{frametitle}
{%
  \ifx\insertframetitle\@empty
  \else
  \begin{beamercolorbox}{frametitle}
  \tikz
  {%
	  \node at (0,0) {};
	  \node at (\textwidth,1) {};
	  \node[anchor=base west] (title) at (0.1,0) {\insertframetitle};
	\begin{scope}[on background layer]
		\filldraw[color=FacultyColor] ([shift={(-.1,.1)}] title.south west) -- ([shift={(.3,0)}] title.south east) -- (title.north east) -- ([shift={(0,-.1)}] title.north west) -- cycle;
	\end{scope}
  }
  \end{beamercolorbox}
  \fi

  \ifx\insertframesubtitle\@empty
  \else
  \begin{beamercolorbox}{framesubtitle}
	  \usebeamerfont{framesubtitle}
  \tikz{%
	  \node at (0,0) {};
	  \node at (\textwidth,0) {};
	  \node[anchor=base west] (title) at (0.2,0) {\insertframesubtitle};
	\begin{scope}[on background layer]
		\filldraw[color=white] ([shift={(0,.1)}] title.south west) -- (title.south east) -- ([shift={(0.1,0)}] title.north east) -- ([shift={(-.1,-.1)}] title.north west) -- cycle;
	\end{scope}
  }
  \end{beamercolorbox}
  \fi
}

% Display a slide before the current section with overview inf
\AtBeginSection[]
{%
   \begin{frame}
       \frametitle{\contentsname}
       \tableofcontents[currentsection,hideothersubsections]
   \end{frame}
}

\newenvironment{halfpage}[1]
{%
\setbeamertemplate{background}
{\tikz{%
	%\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
	\node[anchor=south west,inner sep=0] (background) at (0,0.28125\paperwidth) {\includegraphics[width=\paperwidth]{#1}};
	\filldraw[draw=none,color=white] (background.south west) -- (background.south east) -- (\paperwidth,0.5625\paperwidth) -- (0,0.5625\paperwidth) -- cycle;
}}
\addtobeamertemplate{frametitle}{}{\vspace{2.5cm}}
}{}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Wrap up
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\mode<all>
